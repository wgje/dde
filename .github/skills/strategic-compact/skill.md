---
name: strategic-compact
description: 在正确时机建议压缩上下文，保持对话效率
version: 1.0.0
triggers:
  - "@planner"
  - "@implementation"
---

# 战略压缩技能

帮助在正确的时机压缩上下文，避免在任务中途丢失重要信息。

## 核心理念

**自动压缩的问题**：
- 发生在任意点，往往是任务中途
- 可能丢失正在进行的工作上下文

**战略压缩的优势**：
- 在逻辑阶段切换时进行
- 保留必要的上下文
- 最大化 token 使用效率

## 建议压缩时机

| 时机 | 建议 | 原因 |
|------|------|------|
| 规划完成后 | ✅ 压缩 | 开始全新实现阶段 |
| 调试完成后 | ✅ 压缩 | 清除错误解决的临时上下文 |
| 实现中途 | ❌ 不压缩 | 保留相关变更上下文 |
| 重大里程碑完成 | ✅ 压缩 | 准备下一阶段 |
| 50+ 工具调用后 | ⚠️ 考虑 | 上下文可能过于臃肿 |

## 阶段切换指南

```
探索阶段（收集信息）
    │
    │ ✅ 可以压缩
    ▼
规划阶段（制定方案）
    │
    │ ✅ 可以压缩
    ▼
实现阶段（编写代码）
    │
    │ ❌ 不要压缩（直到完成）
    ▼
验证阶段（测试确认）
    │
    │ ✅ 可以压缩
    ▼
下一个任务
```

## 压缩前检查清单

在压缩上下文前，确保：

- [ ] 当前任务已完成或到达逻辑断点
- [ ] 重要决策已记录到文件或 `.github/context/`
- [ ] 没有未完成的代码变更
- [ ] 测试已通过（如果有变更）

## VS Code 压缩方法

### 方法 1：新建对话
```
点击 Chat 面板的 "+" 按钮，开始新对话
```

### 方法 2：使用检查点
```
使用 /checkpoint 保存当前状态
开始新对话
需要时从检查点恢复
```

### 方法 3：上下文转移
```
/checkpoint "完成了用户认证模块"

然后在新对话中：
请阅读 .github/context/current-focus.md 继续工作
```

## 与 everything-claude-code 的映射

| everything-claude-code | VS Code 实现 |
|------------------------|--------------|
| `suggest-compact.sh` hook | 手动判断 + 新建对话 |
| PreToolUse 计数器 | 关注工具调用数量 |
| `/compact` 命令 | 新建 Chat 对话 |
| 自动提醒 | 依赖 AI 主动建议 |

## 使用示例

**在 AI 消息中可能看到**：

```
建议：我们已经完成了探索阶段，收集了足够的信息。
在开始实现前，建议：
1. 保存当前规划到 .github/context/current-plan.md
2. 开始新的 Chat 对话
3. 在新对话中引用规划文件继续实现
```

## 注意事项

1. **不要过度压缩**: 频繁压缩会丢失连续性
2. **先保存再压缩**: 确保重要信息已持久化
3. **标记阶段**: 明确告诉 AI 当前处于哪个阶段
4. **信任 AI 建议**: 当 AI 建议压缩时，通常是合理的
