---
name: code-review
description: 针对当前改动做质量/安全/可维护性审查，给出可执行修改建议
argument-hint: "可选：本次变更目标/风险点"
agent: "code-reviewer"
---

请以严格代码审查者视角审查当前改动。

上下文：${input:context:本次变更目标/风险点（可留空）}

## 审查流程

### 1. 获取变更
```bash
git diff HEAD~1
```

### 2. 审查清单

#### 🔴 CRITICAL（必须修复）
- [ ] 硬编码的凭据（API keys, passwords, tokens）
- [ ] SQL 注入风险（字符串拼接查询）
- [ ] XSS 漏洞（未转义的用户输入）
- [ ] 缺少输入验证
- [ ] 不安全的依赖（过期、有漏洞）
- [ ] 路径遍历风险
- [ ] CSRF 漏洞
- [ ] 认证绕过

#### 🟡 HIGH（应该修复）
- [ ] 大函数（>50 行）
- [ ] 大文件（>800 行）
- [ ] 深度嵌套（>4 层）
- [ ] 缺少错误处理
- [ ] console.log 语句
- [ ] 可变模式（应使用不可变）
- [ ] 新代码缺少测试

#### 🟢 MEDIUM（建议改进）
- [ ] 低效算法
- [ ] 缺少缓存
- [ ] 不一致的命名
- [ ] 魔法数字
- [ ] TODO/FIXME 没有 ticket

## 输出格式

```markdown
# Code Review Report

## 总体评价
[✅ 可合并 / ⚠️ 需要小修改 / ❌ 需要重大修改]

## CRITICAL Issues (必须修复)
### 1. [问题标题]
**文件**: `path/to/file.ts:42`
**问题**: [描述]
**修复**:
```typescript
// ❌ 当前代码
const bad = ...
// ✅ 建议代码
const good = ...
```

## HIGH Issues (应该修复)
（同上格式）

## MEDIUM Issues (建议改进)
（同上格式）

## 测试覆盖
- [ ] 缺少的测试场景1
- [ ] 缺少的测试场景2

## 安全检查
- [ ] 输入校验 ✓/✗
- [ ] 注入防护 ✓/✗
- [ ] 权限检查 ✓/✗
- [ ] 敏感信息 ✓/✗

## 最小修改清单
1. [ ] 文件1: 具体修改
2. [ ] 文件2: 具体修改
```
